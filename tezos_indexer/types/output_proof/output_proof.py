from __future__ import absolute_import

import json


from tezos_indexer.types.output_proof.unpacker import BaseBinarySchema


class OutputProofData(BaseBinarySchema):
    _schema = [
        ('output_proof', None, 'OutputProof'),
        ('output_proof_state', 32, 'hex32'),
        ('output_proof_output', None, 'OutputProofOutput'),

        # ('output_proof_output', None, 'OutboxMessage'),
        # ('output_proof_output', None, 'Message'),
    ]


# message_hex = '030002a1f1fd3bdbea49e335f7c4a00810399391f41dd0d00cdd2ca7530f28bb8d0b08a1f1fd3bdbea49e335f7c4a00810399391f41dd0d00cdd2ca7530f28bb8d0b080005820764757261626c65d00750d58adc7effd32ed1ae02bd582e5c854b1e3bf96a20172a5b5c6097c1951f03746167c00800000004536f6d650003c0a4159831771b4c2b0098d5b8f3c168303dfc5b138bacd2960bf2f34ebdbcf86a820576616c7565810370766d8107627566666572738205696e707574820468656164c00100066c656e677468c00100066f75747075740004820132810a6c6173745f6c6576656cc004002b4ecf0133810f76616c69646974795f706572696f64c00400013b0082013181086f7574626f78657301143c0109eec0994fb80712b4ae5e10df8550e8f8acaddb32c0984e22f66ed7670d596354ca300105320102a6010160c0e65f7171b644ce9598cdb5717af286399d3b59220c2306e8e6dbdbf33241121600b70064c0b5fdce54cf432f038baef9b49c7d9c523155cbb7668badcf8ef7be590a7f0bbb0030c0ec2f27e6abce09564b796f443ad93f611a43bf5df69c3c049425b35ef46a472d0015c02da9d735afe849f2b94eb45384aa0e8082035905d206393a040f767a8db68c5d000c0005c00e02cf9c2435470031ecec00a49bb6459419de433bfb5739b9a1bc9358a87b3f0003820732383336343435820468656164c00100066c656e677468c0010007323833383138390003810468656164c001008208636f6e74656e7473810130c0d3000000cf00000000ca07070a0000001600000ff91d3da1fbeb517f3013deb5f53ceb3c79b2ec07070a0000001601a6938a03cf1d7652a7b871bd9c7c36b4655fa8030007070707000005090a0000005f05020000005907040100000010636f6e74726163745f616464726573730a0000001c050a000000160155275f943ba305902a52dbf648236db528e0f015000704010000000a746f6b656e5f747970650a0000000b0501000000054641312e32001101a6938a03cf1d7652a7b871bd9c7c36b4655fa80300000000087769746864726177066c656e677468c00101c01a7c3601bdbc60c4818bbc57f1d65a540c1071e6cd15e6bd3d1d10c156b35fbac0c1aab70f277ebb484797572980e37d5f7b4ced12e1fab3fc0223d6fde7281cd3c07a568cfe12ae3e6b6866815daf8b66dd778214959618a1c5abb56d772845ba14c0936277661e120c94ced578c1ac2b5a6e11fc0d6c2f3b9636729eafdd69d54956c065733161efbe9549857f2effdf2cd5934c21b401469c36230dfb862713f88644c0ce4f8650110977fb79ce2af58245bb7719cb569a5f4dd88e0d063b13802f7e550134810d6d6573736167655f6c696d6974c002a401047761736dd0c5402eafc7cf0dd9cfc76c519ed54186888d2ac96b2c1b5fdfe4c924999ae7c1a1f1fd3bdbea49e335f7c4a00810399391f41dd0d00cdd2ca7530f28bb8d0b08002b4ead0000000000ca07070a0000001600000ff91d3da1fbeb517f3013deb5f53ceb3c79b2ec07070a0000001601a6938a03cf1d7652a7b871bd9c7c36b4655fa8030007070707000005090a0000005f05020000005907040100000010636f6e74726163745f616464726573730a0000001c050a000000160155275f943ba305902a52dbf648236db528e0f015000704010000000a746f6b656e5f747970650a0000000b0501000000054641312e32001101a6938a03cf1d7652a7b871bd9c7c36b4655fa80300000000087769746864726177'
message_hex = '030002fe5a4d1c15691eaa1625d70d6ea29432f16d0f3630e006ff51bf1980a7a248dafe5a4d1c15691eaa1625d70d6ea29432f16d0f3630e006ff51bf1980a7a248da0005820764757261626c65d06ab14332668a66a1e546c8c8f4b05fc0712d01a357aa0fd6ab8f748ccf41f88e03746167c00800000004536f6d650003c044a02c7d251e1e8234cf496ba37fa343e2b1406321f0e5c5c1dea411753481b5820576616c7565810370766d8107627566666572738205696e707574820468656164c00100066c656e677468c00100066f75747075740004820132810a6c6173745f6c6576656cc004002b45e70133810f76616c69646974795f706572696f64c00400013b0082013181086f7574626f786573010b54c09398dc3a36917bfbd76c66bf959e0b175aac3c83fe1e18f82c36effd1b7c8c790105cbc093f5a5f9a38e0cef39ef997a07e97ad56857d3d348f61b1f3a767f59eebf0b290102e3c0df2321b36d8003edab50ddffab4991eb94c0db6e8c629eb215c3b051e081acd701016ec0faf068b39020f643505cb15841d598f8639e235f30cb60086c7fdf2430ed012500ba0058c0b372740bb5327281c8cefbd4811807479ac95dead6769c495dfc60c87f7707ed00300017c0c4fab792e58720c45a4737a530d2eb984f8b8d8f09d1b2aa442c2046462253bf0009c0c8b6224279bf9364d594a3823017b221d5cc12517fd2e56b2a088b3574fc191300060003e00003c07cd4b7ebce1eb9daaa8b9e5a94e477a68911e39c704621715bbb15f1594b9c4d820732383334303537820468656164c00100066c656e677468c0010007323833353933390003810468656164c001008208636f6e74656e7473810130c0d3000000cf00000000ca07070a0000001600000ff91d3da1fbeb517f3013deb5f53ceb3c79b2ec07070a0000001601a6938a03cf1d7652a7b871bd9c7c36b4655fa8030007070707000005090a0000005f05020000005907040100000010636f6e74726163745f616464726573730a0000001c050a000000160155275f943ba305902a52dbf648236db528e0f015000704010000000a746f6b656e5f747970650a0000000b0501000000054641312e32000701a6938a03cf1d7652a7b871bd9c7c36b4655fa80300000000087769746864726177066c656e677468c00101c0c92ad1b14240d5bf885e446ed172269bf883484bea59b61804fdf834bf509e89c0522b9c355b55d8d1812dbf6e7bd478394fcbeec4c952aa7cf7e8922f41fe13c1c070757e7d1a45bbbde1c171d11a3c7ded59374ae8c0d116022895527f59bd362c0134810d6d6573736167655f6c696d6974c002a401047761736dd0cce1cc8a4a9ac0b9e9597a9dff613c88bb75b1df89f5ebcc756f47f1bb8c0625fe5a4d1c15691eaa1625d70d6ea29432f16d0f3630e006ff51bf1980a7a248da002b45e30000000000ca07070a0000001600000ff91d3da1fbeb517f3013deb5f53ceb3c79b2ec07070a0000001601a6938a03cf1d7652a7b871bd9c7c36b4655fa8030007070707000005090a0000005f05020000005907040100000010636f6e74726163745f616464726573730a0000001c050a000000160155275f943ba305902a52dbf648236db528e0f015000704010000000a746f6b656e5f747970650a0000000b0501000000054641312e32000701a6938a03cf1d7652a7b871bd9c7c36b4655fa80300000000087769746864726177'

message_bytes = bytes.fromhex(message_hex)
output_proof = OutputProofData(message_bytes)
result, size = output_proof.unpack()
print(json.dumps(result))
print(message_bytes[size:].hex())
